
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEOå››å¤§è§¦ç‚¹æ•´åˆç›‘æ§ç³»ç»Ÿ</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background: #f5f7fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; }
        .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .metric-item { text-align: center; padding: 15px; border-radius: 8px; background: #f8f9fa; }
        .metric-value { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
        .metric-label { font-size: 12px; color: #6c757d; }
        .alert { padding: 10px; border-radius: 5px; margin: 5px 0; }
        .alert-warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .alert-critical { background: #f8d7da; border-left: 4px solid #dc3545; }
        .chart-container { height: 300px; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-active { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-critical { background: #dc3545; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ GEOå››å¤§è§¦ç‚¹æ•´åˆç›‘æ§ç³»ç»Ÿ</h1>
        <p>å®æ—¶ç›‘æ§AIæœç´¢ã€ç¤¾äº¤å†…å®¹ã€ç”µå•†AIå¯¼è´­ã€ç§åŸŸå®¢æœ</p>
    </div>

    <div class="dashboard">
        <!-- æ•´ä½“æ¦‚è§ˆ -->
        <div class="card">
            <h3>ğŸŒŸ æ•´ä½“GEOè¡¨ç°</h3>
            <div class="chart-container" id="overallGeoChart"></div>
        </div>

        <!-- å››å¤§è§¦ç‚¹çŠ¶æ€ -->
        <div class="card">
            <h3>ğŸ“Š å››å¤§è§¦ç‚¹çŠ¶æ€</h3>
            <div id="touchpointStatus"></div>
        </div>

        <!-- AIå¼•ç”¨ç‡è¶‹åŠ¿ -->
        <div class="card">
            <h3>ğŸ¤– AIå¼•ç”¨ç‡è¶‹åŠ¿</h3>
            <div class="chart-container" id="citationRateChart"></div>
        </div>

        <!-- ç³»ç»Ÿè­¦æŠ¥ -->
        <div class="card">
            <h3>ğŸš¨ ç³»ç»Ÿè­¦æŠ¥</h3>
            <div id="systemAlerts"></div>
        </div>
    </div>

    <script>
        // WebSocketè¿æ¥
        const socket = io();
        
        // å›¾è¡¨å®ä¾‹
        let overallGeoChart = echarts.init(document.getElementById('overallGeoChart'));
        let citationRateChart = echarts.init(document.getElementById('citationRateChart'));
        
        // ç›‘å¬æ•°æ®æ›´æ–°
        socket.on('dashboard_update', function(data) {
            updateDashboard(data);
        });
        
        function updateDashboard(data) {
            updateOverallGeoChart(data.overall_geo_score);
            updateTouchpointStatus(data.touchpoints);
            updateCitationRateChart(data.touchpoints);
            updateSystemAlerts(data.touchpoints);
        }
        
        function updateOverallGeoChart(score) {
            const option = {
                series: [{
                    type: 'gauge',
                    axisLine: {
                        lineStyle: {
                            width: 30,
                            color: [
                                [0.3, '#fd666d'],
                                [0.7, '#ffc107'],
                                [1, '#28a745']
                            ]
                        }
                    },
                    pointer: { itemStyle: { color: 'auto' } },
                    axisTick: { distance: -30, length: 8, lineStyle: { color: '#fff', width: 2 } },
                    splitLine: { distance: -30, length: 30, lineStyle: { color: '#fff', width: 4 } },
                    axisLabel: { color: 'auto', distance: 40, fontSize: 14 },
                    detail: { fontSize: 24, formatter: '{value}åˆ†' },
                    data: [{ value: score, name: 'GEOåˆ†æ•°' }]
                }]
            };
            overallGeoChart.setOption(option);
        }
        
        function updateTouchpointStatus(touchpoints) {
            const container = document.getElementById('touchpointStatus');
            container.innerHTML = '';
            
            const touchpointNames = {
                'ai_search': 'AIæœç´¢æµé‡',
                'social_content': 'ç¤¾äº¤å†…å®¹æµé‡',
                'ecommerce_ai': 'ç”µå•†AIå¯¼è´­',
                'private_domain': 'ç§åŸŸAIå®¢æœ'
            };
            
            Object.entries(touchpoints).forEach(([key, data]) => {
                const status = data.geo_score >= 70 ? 'active' : (data.geo_score >= 50 ? 'warning' : 'critical');
                const statusDiv = document.createElement('div');
                statusDiv.className = 'metric-item';
                statusDiv.innerHTML = `
                    <div class="metric-value">
                        <span class="status-indicator status-${status}"></span>
                        ${data.geo_score.toFixed(1)}åˆ†
                    </div>
                    <div class="metric-label">${touchpointNames[key]}</div>
                `;
                container.appendChild(statusDiv);
            });
        }
        
        function updateCitationRateChart(touchpoints) {
            const data = Object.entries(touchpoints).map(([key, data]) => ({
                name: key,
                value: data.ai_citation_rate
            }));
            
            const option = {
                tooltip: { trigger: 'item' },
                legend: { bottom: '5%' },
                series: [{
                    type: 'pie',
                    radius: ['40%', '70%'],
                    data: data,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            citationRateChart.setOption(option);
        }
        
        function updateSystemAlerts(touchpoints) {
            const container = document.getElementById('systemAlerts');
            container.innerHTML = '';
            
            Object.values(touchpoints).forEach(data => {
                data.alerts.forEach(alert => {
                    const alertDiv = document.createElement('div');
                    alertDiv.className = `alert alert-${alert.level}`;
                    alertDiv.innerHTML = `
                        <strong>${alert.title}</strong><br>
                        ${alert.message}
                    `;
                    container.appendChild(alertDiv);
                });
            });
            
            if (container.children.length === 0) {
                container.innerHTML = '<div class="alert">âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼Œæš‚æ— è­¦æŠ¥</div>';
            }
        }
        
        // åˆå§‹åŒ–åŠ è½½æ•°æ®
        fetch('/api/dashboard')
            .then(response => response.json())
            .then(data => updateDashboard(data))
            .catch(error => console.error('Error loading dashboard data:', error));
    </script>
</body>
</html>
    